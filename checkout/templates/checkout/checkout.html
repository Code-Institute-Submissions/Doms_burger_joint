{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'checkout/css/checkout.css' %}">
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="below-nav-container">
        <div class="checkout-form-container">
            {% if not request.user.is_authenticated %}
            <p>You are not currently logged in to your account. To be eligible for rewards, please sign in <a href="{% url 'account_login' %}?next={{request.path}}">here</a>.</p>
            {% elif reward_notification %}
            <div id="rewards-notification">
            {{ reward_notification }} 
            <button><a href="{% url 'menu' %}?category=burgers">Get free burger</a></button>
            </div>
            {% elif discount %}
            <div id="rewards-notification">Congratulations you've earned a free burger! Saving yourself £{{ discount }}.</div>
            {% endif %}
            <form action="{% url 'checkout' %}" method="POST" id="payment-form">
            {% csrf_token %}
                <h2 class="form-subtitle">Who wants these Burgers?</h2>
                    {% for field in form %}
                        {% if field.name == 'address_line1' %}
                            <h2 class="form-subtitle"> Where these burgers heading?</h2>
                        {% endif %}
                        <p>{{ field.label }}</p>
                        <p>{{ field }}</p>  
                    {% endfor %}
                <p>Payment</p>
                <div id="card-element"><!--Stripe.js injects the Card Element--></div>

                <p id="card-error" role="alert"></p>
                <input type="hidden" value="{{ client_secret }}" name="client_secret">
                <p class="result-message hidden">
                    Payment succeeded
                </p>

                <button class="submit">
                    PLACE YOUR ORDER (£{{ total|floatformat:2 }})
                </button>

            </form>
        </div>
    </div>
    <div id="loading-overlay">
        <div class="loading-animation">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
        
        
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    {{ stripe_public_key|json_script:"id_stripe_public_key" }}
    {{ client_secret|json_script:"id_client_secret" }}
    <script src="{% static 'checkout/js/stripe_element.js' %}"></script>
{% endblock %}